name: Generate DocuSign Admin Connector (Fixed Spec)

on:
  workflow_dispatch:

jobs:
  prepare-spec:
    name: Prepare OpenAPI Spec
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download DocuSign OpenAPI Spec
        run: |
          mkdir -p docs/spec
          curl -L \
            https://raw.githubusercontent.com/docusign/OpenAPI-Specifications/master/admin.rest.swagger-v2.1.json \
            -o docs/spec/openapi_raw.json

      - name: Fix invalid OpenAPI paths
        run: |
          sed 's|"\\.1/|"/v1/|g' docs/spec/openapi_raw.json > docs/spec/openapi.json
          echo "âœ… Corrected OpenAPI written to docs/spec/openapi.json"

      - name: Upload corrected spec artifact
        uses: actions/upload-artifact@v4
        with:
          name: corrected-openapi
          path: docs/spec/openapi.json


  generate-connector:
    name: Generate Connector
    needs: prepare-spec
    uses: ./.github/workflows/auto_generate_connector_template.yml
    secrets: inherit
    with:
      openapi-url: docs/spec/openapi.json
      ballerina-version: "2201.13.0"
      quiet-mode: true
